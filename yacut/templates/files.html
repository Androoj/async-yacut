{% extends "base.html" %}
{% block content %}
  <main>
    <section class="container my-5 px-4">
      <h1 class="text-center mb-4">
        <span style="color:red">Ya</span>Cut
      </h1>
      <p class="text-center mb-4">
        Загрузите файлы и получите на них короткие ссылки
      </p>
      <div class="row justify-content-center">
        <div class="col-sm-6">
          <form method="POST" novalidate enctype="multipart/form-data">
            {{ form.csrf_token }}
            <div class="input-group mb-3">
              {{ form.files(
                  class="form-control",
                  id="file-input",
                  onchange="updateFileName(this)"
              ) }}
            </div>
            {{ form.submit(class="btn btn-primary") }}
          </form>
        </div>
      </div>
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="row justify-content-center mt-3">
            <div class="col-sm-6">
              <div class="alert alert-danger">
                {% for message in messages %}
                  <p class="mb-0">{{ message }}</p>
                {% endfor %}
              </div>
            </div>
          </div>
        {% endif %}
      {% endwith %}
      {% if files_list %}
        <div class="row justify-content-center mt-4">
          <div class="col-sm-8">
            <table class="table table-borderless">
              <tbody>
                {% for item in files_list %}
                  <tr>
                    <td>{{ item.filename }}</td>
                    <td>
                      <a href="{{ item.short_link }}" target="_blank" rel="noopener">
                        {{ item.short_link }}
                      </a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      {% else %}
        <div class="row justify-content-center mt-4">
          <div class="col-sm-8 text-center text-muted">
            <p>После загрузки файлов здесь появятся короткие ссылки.</p>
          </div>
        </div>
      {% endif %}
    </section>
  </main>
  <script>
    function updateFileName(input) {
      const fileNames = Array.from(input.files).map(f => f.name);
      const label = document.querySelector('.input-group-text');
      if (fileNames.length === 0) {
        label.textContent = 'Выбрать файлы';
      } else {
        label.textContent = `${fileNames.length} файл${fileNames.length === 1 ? '' : 'а'}`;
      }
    }
  </script>
{% endblock content %}